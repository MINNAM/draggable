<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style>

		html{

		   height: 100%;
		   background : rgb(230,230,230);

		}

		body {

			height: 100%;

		}

		* {

			margin: 0;
			padding: 0;
			-webkit-user-select: none;
    		 -moz-user-select: none;
 			 user-select: none;
		}

		.views {

			display: inline-block;
			width: 100%;
			height: 200%;

		}

		.container {

			float:left;
		}

		canvas {
			 -webkit-user-select: none;
 			 -khtml-user-select: none;
			  -moz-user-select: none;
			  -o-user-select: none;
			  user-select: none;

			  background : white;
		}

		#homeContainer { 

			display: inline-block;
			width: 10%;
			height: 100%;

		}

		#logoContainer {

			width: 100%;
			height: 12%;

		}

		#viewContainer { 
			display: inline-block;
			width: 1024px;
			height: 100%;

		}

	</style>
</head>
<body>
<div style = 'width: 100%; height: 1%; display: inline-block;'>
	
</div>
<div id = 'homeContainer' class = 'container'>
	<div id = 'logoContainer' ></div>

</div>

<div id = 'viewContainer' class = 'container'>
	<div style = "width: 100%; height: 10%; display: inline-block; background: rgb(60,60,60); margin-bottom: 5px;">
		<canvas id = 'ruler' style = 'width: 100%; height: 80%;'></canvas>
	</div>
	<canvas class = 'views' id = 'view1' ></canvas>
	<canvas class = 'views' id = 'view2' ></canvas>
</div>

<script src = './View.js'></script>
<script>
	
	var ruler = new Canvas( 'ruler' );


	console.log( ruler.node() );

</script>

<script src = '../draggable.js'></script>

<script>

	var options = {

		maxWidth : 600

	}

	var BoxManager = function() {

		var BoxManager = new List();

		BoxManager.update = function() {

			var nodes = this.nodes();

			for( var key in nodes ) {

				nodes[ key ].update();

			
			}
		}

		BoxManager.add = function( a, b ) {

			this.nodes()[ a ] = b;
			this.nodes()[ a ].id = this.nodes().length;

		}

		return BoxManager;

	}();

	var index = 0;

	var Box = function( ctx, color ) {

		this.id     = index++;
		this.ctx    = ctx;
		this.x 		= 0;
		this.y 	    = 0;
		this.width  = 0;
		this.height = 0;
		this.color  = color;
		this.highlight = false;

	}

	Box.prototype.update = function() {

		this.ctx.beginPath();

			this.ctx.rect( this.x, this.y, this.width, this.height );

			if( this.highlight ) {

				this.ctx.fillStyle = "rgba( 100, 207, 168, 0.5 )";

			} else {

				this.ctx.fillStyle = this.color;

			}
			
			this.ctx.fillStyle = this.color;
			this.ctx.fill();

		this.ctx.closePath();

	}

	
	var BoxEditor = function( ctx, box ) {

		this.ctx    = ctx;
		this.x 		= box.x;
		this.y 	    = box.y;
		this.width  = box.width;
		this.height = box.height;

		console.log( box );
		
	}

	BoxEditor.prototype.displayMenu = function() {

		this.ctx.beginPath();
			
			this.ctx.arc( this.x + this.width, this.y + this.height, 10, 0, Math.PI * 2 );

			this.ctx.strokeColor = "rgb(230,230,230)";
			this.ctx.fillStyle = "white";

			this.ctx.stroke();
			this.ctx.fill();
		this.ctx.closePath();

	}
	

	var canvas = new Canvas( 'view1' );

	var GLOBAL_BOX_KEY;

	var drag = DraggableFactory.new({ 

		name: 'view1', node: canvas.node()

	}).move( function( x, y, el, global ) {

		var boxes = BoxManager.nodes();

		for( var key in boxes ) {

			if( ( x > boxes[ key ].x && x < boxes[ key ].x + boxes[ key ].width ) && ( y > boxes[ key ].y && y < boxes[ key ].y + boxes[ key ].height ) ) {

				boxes[ key ].highlight = true;
				GLOBAL_BOX_KEY = key;
				DraggableManager.toggle( "view2" );

			}else {

				boxes[ key ].highlight = false;

			}
			
		}

		canvas.clear();

		BoxManager.update();


	}).drag( function( x, y, el, global ) {
		
		console.log( x );
	
		canvas.path( function( ctx ) {

			global.box.width  = x - global.box.x;
			global.box.height = y - global.box.y;

			ctx.rect( global.box.x, global.box.y, global.box.width, global.box.height );
			ctx.fillStyle = 'rgba(100, 207, 168, 0.1)';
			ctx.fill();

		});

					
		

	}).down( function( x, y, el, global ) {

		global.box   = new Box( canvas.ctx(), 'rgb(100, 207, 168 )' );
		global.box.x = x;
		global.box.y = y;

	}).up( function( x, y, el, global ){


		BoxManager.add( BoxManager.size(), global.box );

	});

	var drag = DraggableFactory.new({ 

		name: 'view2', node: canvas.node()

	}).move( function( x, y, el, global ) {

		global.box = BoxManager.nodes()[ GLOBAL_BOX_KEY ];
	
		if( !( ( x > global.box.x && x < global.box.x + global.box.width ) && ( y > global.box.y && y < global.box.y + global.box.height ) ) ) {

			global.editor  = undefined;
			GLOBAL_BOX_KEY = null;
			DraggableManager.toggle( "view1" );

		}

		canvas.clear();
		BoxManager.update();

		


		document.getElementById( 'logoContainer' ).innerHTML = global.box.id;



	}).double( function( x, y, el, global ) {

		
		DraggableManager.toggle( "view3");
		


	}).drag( function( x, y, el, global ) {


		global.box.x = x - global.initialX;
		global.box.y = y - global.initialY;
	

	}).down( function( x, y, el, global ) {

		global.initialX = ( x - global.box.x );
		global.initialY = ( y - global.box.y );

	}).up( function( x, y, el, global ){


	});

	var drag = DraggableFactory.new({ 

		name: 'view3', node: canvas.node()

	}).move( function( x, y, el, global ) {

		global.box = BoxManager.nodes()[ GLOBAL_BOX_KEY ];
		global.editor = new BoxEditor( canvas.ctx(), global.box );

		canvas.clear();
		BoxManager.update();

		global.editor.displayMenu();

	}).double( function( x, y, el, global ) {

		DraggableManager.toggle( "view2");

	}).drag( function( x, y, el, global ) {
	

	}).down( function( x, y, el, global ) {


	}).up( function( x, y, el, global ){


	});


	DraggableManager.toggle( "view1");

</script>
</body>
</html>